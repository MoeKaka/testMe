DECLARE
    v_sql VARCHAR2(4000);
BEGIN
    -- Create a temporary table to store results
    EXECUTE IMMEDIATE 'CREATE GLOBAL TEMPORARY TABLE temp_table_counts (
        table_name VARCHAR2(100),
        row_count NUMBER,
        status VARCHAR2(20)
    ) ON COMMIT PRESERVE ROWS';

    -- Get all tables from the schema
    FOR t IN (SELECT table_name 
             FROM all_tables 
             WHERE owner = 'KAKA'
             ORDER BY table_name) LOOP
        
        -- Build dynamic SQL to count rows in each table
        v_sql := 'INSERT INTO temp_table_counts 
                  SELECT :1, COUNT(*), 
                         CASE 
                             WHEN COUNT(*) = 0 THEN ''Empty''
                             ELSE ''Not Empty''
                         END
                  FROM KAKA.' || t.table_name;
        
        -- Execute the dynamic SQL
        EXECUTE IMMEDIATE v_sql USING t.table_name;
        
        COMMIT;
    END LOOP;

    -- Query and display results
    FOR r IN (SELECT table_name,
                     row_count,
                     status
              FROM temp_table_counts
              ORDER BY status DESC, table_name) LOOP
        DBMS_OUTPUT.PUT_LINE(RPAD(r.table_name, 40) || 
                            RPAD(r.row_count, 10) || 
                            r.status);
    END LOOP;

    -- Clean up
    EXECUTE IMMEDIATE 'DROP TABLE temp_table_counts PURGE';
EXCEPTION
    WHEN OTHERS THEN
        -- Clean up in case of error
        EXECUTE IMMEDIATE 'DROP TABLE temp_table_counts PURGE';
        RAISE;
END;
/
